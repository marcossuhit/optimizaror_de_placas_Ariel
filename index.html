<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#050607" />
    <title>PCAMOBLAMIENTOS ¬∑ Planificador de Cortes</title>
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="icon" type="image/jpeg" href="icons/pcicon.jpeg" />
    <link rel="apple-touch-icon" href="icons/pcicon.jpeg" />
    <link rel="stylesheet" href="style.css" />
    <!-- Opcional: Google Analytics. Reemplaza G-XXXXXXXXXX con tu ID o deja vac√≠o para desactivar -->
    <!-- Google tag (gtag.js) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-NGT3H3SWNC"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-NGT3H3SWNC');
      </script>
  </head>
  <body>
    <header class="app-header">
      <div class="header-main">
        <h1>
          <img src="icons/pcicon.jpeg" alt="PCAMOBLAMIENTOS" class="app-title-icon" />
          Planificador de Cortes para Carpinter√≠a
        </h1>
      </div>
      <div class="user-session" id="userSession" style="display:none;">
        <div class="user-avatar" id="userAvatar"></div>
        <div class="user-meta">
          <span class="user-greeting" id="userGreeting"></span>
          <span class="user-email" id="userEmail"></span>
        </div>
        <button id="signOutBtn" class="btn ghost-btn" type="button">Cerrar sesi√≥n</button>
      </div>
    </header>

    <main class="container">
      <section class="controls">
        <div class="project">
          <label for="projectName">Nombre del proyecto</label>
          <input id="projectName" type="text" placeholder="Ej: Muebles Juan ‚Äì Biblioteca" />
        </div>
        <div class="export-group">
          <button id="installBtn" class="btn" style="display:none">Instalar app</button>
          <button id="generateLayoutBtn" class="btn" style="display:none;font-weight:bold;">üîÑ Recalcular Optimizaci√≥n</button>
          <button id="saveJsonBtn" class="btn">Guardar</button>
          <button id="loadJsonBtn" class="btn">Cargar</button>
          <button id="exportPdfBtn" class="btn">Exportar PDF</button>
          <button id="sendCutsBtn" class="btn primary">Enviar cortes</button>
          <button id="manageStockBtn" class="btn">Backoffice stock</button>
          <button id="themeToggle" class="btn">Modo claro</button>
        </div>
      </section>

      <div class="main-grid">
        <div class="stack">
          <section class="sheet">
            <h2 class="sheet-title">Placas</h2>
            <div class="plates-controls">
              <button id="addPlateBtn" class="btn">Agregar placa</button>
              <label class="plate-material">
                <span>Material</span>
                <select id="plateMaterialSelect">
                  <option value="">Seleccione</option>
                </select>
              </label>
              <span class="limit-note">Agrega una o m√°s placas (ancho, alto, cantidad)</span>
              <label class="plate-edge-catalog">
                <span>Cubre cantos</span>
                <select id="edgeCatalogSelect" class="edge-catalog-select">
                  <option value="">Seleccion√° un cubre canto</option>
                </select>
              </label>
            </div>
            <div id="plates" class="plates"></div>
          </section>

          <section id="rows" class="rows">
            <!-- Las filas se agregan din√°micamente -->
          </section>

          <section class="rows-header">
            <p class="rows-intro">
              Complete la(s) placa(s) para habilitar filas. Ingrese tipos de cortes. Cada fila muestra un rect√°ngulo con bordes clicables para marcar selecci√≥n.
            </p>
            <div class="rows-controls">
              <button id="addRowBtn" class="btn primary" disabled>Agregar fila</button>
              <button id="clearAllBtn" class="btn danger disabled-btn" disabled>Limpiar filas</button>
              <button id="resetAllBtn" class="btn btn-soft disabled-btn" disabled>Limpiar entradas</button>
              <span id="addRowHint" class="hint-inline"></span>
              <label class="hint-inline" style="margin-left:auto; display:inline-flex; align-items:center; gap:6px;">
                <input id="autoRotateToggle" type="checkbox" checked /> Rotaci√≥n autom√°tica permitida
              </label>
            </div>
          </section>
        </div>

        <aside class="summary" id="summaryPanel">
          <h2 class="summary-title">Detalle de Placas</h2>
          <div id="summaryPieces" class="summary-stat" style="display:none;">Piezas colocadas: 0</div>
          <div id="summaryPlates" class="summary-stat" style="display:none;">Placas utilizadas: 0</div>
          <div id="summaryPlateCost" class="summary-stat" style="display:none;">Costo placas: $0</div>
          <div id="summaryArea" class="summary-stat" style="display:none;">√Årea utilizada: 0 m¬≤</div>
          <div id="summaryUtil" class="summary-stat" style="display:none;">Aprovechamiento: 0%</div>
          <div id="summaryWaste" class="summary-stat" style="display:none;">Desperdicio: 0 m¬≤ (0%)</div>
          <div id="summaryReq" class="summary-stat" style="display:none;">Cortes pedidos: 0</div>
          <div id="summaryPlaced" class="summary-stat" style="display:none;">Colocados: 0</div>
          <div id="summaryLeft" class="summary-stat" style="display:none;">Fuera: 0</div>
          <h3 class="summary-subtitle" style="display:none;">Filas</h3>
          <ul id="summaryList" class="summary-list"></ul>
          
          <div id="summaryPlatesValue" class="summary-plates-value"></div>
          <div id="summaryTotal" class="summary-total">Cantidad de cubre canto: 0 mm</div>
          <div id="summaryGrandTotal" class="summary-grand-total"></div>

          <section class="social-connect" aria-labelledby="socialConnectTitle">
            <h3 id="socialConnectTitle" class="panel-title">Conect√° con nuestras redes</h3>
            <p class="panel-description">Seguinos para conocer lanzamientos, promociones y novedades en tiempo real.</p>
            <ul class="social-links">
              <li>
                <a id="whatsAppLink" href="https://wa.me/542494566642?text=PCAMOBLAMIENTOS%20te%20envia%20la%20planificacion%20de%20cortes." target="_blank" rel="noopener noreferrer">
                  <span class="social-icon social-icon--whatsapp" aria-hidden="true" data-icon="WA"></span>
                  <span class="social-label">WhatsApp</span>
                </a>
              </li>
              <li>
                <a href="https://www.instagram.com" target="_blank" rel="noopener noreferrer">
                  <span class="social-icon social-icon--instagram" aria-hidden="true" data-icon="IG"></span>
                  <span class="social-label">Instagram</span>
                </a>
              </li>
              <li>
                <a href="https://www.facebook.com" target="_blank" rel="noopener noreferrer">
                  <span class="social-icon social-icon--facebook" aria-hidden="true" data-icon="f"></span>
                  <span class="social-label">Facebook</span>
                </a>
              </li>
              <li>
                <a href="https://www.youtube.com" target="_blank" rel="noopener noreferrer">
                  <span class="social-icon social-icon--youtube" aria-hidden="true" data-icon="YT"></span>
                  <span class="social-label">YouTube</span>
                </a>
              </li>
            </ul>
          </section>
        </aside>
      </div>

      <section class="sheet-overview">
        <h2 class="sheet-title">Placa completa</h2>
        <div id="sheetCanvas" class="sheet-canvas">
          <div class="hint">Configure la placa para ver la vista</div>
        </div>
      </section>

      <!-- Panel oculto de visitas (solo visible con atajo) -->
      <section id="adminPanel" style="display:none; margin-top:16px;" class="sheet">
        <h2 class="sheet-title">Visitas (local)</h2>
        <div id="visitSummary" class="summary-stat"></div>
        <div style="overflow:auto; max-height:260px; border:1px dashed #223048; padding:8px; border-radius:8px;">
          <table id="visitTable" style="width:100%; border-collapse:collapse; font-size:.9rem;">
            <thead><tr><th style="text-align:left; padding:4px;">Fecha</th><th style="text-align:left; padding:4px;">Agente</th><th style="text-align:left; padding:4px;">Plataforma</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <button id="clearVisitsBtn" class="btn">Borrar registros locales</button>
          <span class="hint-inline">Atajo: Ctrl+Shift+L para mostrar/ocultar</span>
          <div style="margin-left:auto; display:flex; gap:6px; align-items:center;">
            <label class="hint-inline">GA4 ID:</label>
            <input id="gaIdInput" type="text" placeholder="G-XXXXXXXXXX" style="height:34px; padding:0 8px; border-radius:8px; border:1px solid #233046; background:#0e1629; color:var(--text); min-width:180px;" />
            <button id="saveGaIdBtn" class="btn">Guardar GA ID</button>
          </div>
        </div>
      </section>

    </main>

    <script src="stock-sync-config.js"></script>
    <script src="stock-sync.js"></script>
    <script src="email-provider-config.js"></script>
    <script src="email-provider.js"></script>
    <script src="auth.js"></script>
    <script type="module" src="app.js"></script>
  </body>
  </html>
